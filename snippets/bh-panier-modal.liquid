{% assign collection_handle = 'goodies' %}
{% assign collection = collections[collection_handle] %}

{% assign montant1 = 5000 %}
{% assign montant2 = 10000 %}
{% assign montant3 = 15000 %}

{% if collection.products.size > 0 %}
  {% assign first_product = collection.products[2] %}
  {% assign second_product = collection.products[1] %}
  {% assign third_product = collection.products[0] %}
{% endif %}

{% if cart.total_price > 0 and cart.total_price < montant1 %}
  {% assign resultat = montant1 | minus: cart.total_price | divided_by: 100.0 %}
  {% assign phrase = "Dépensez " | append: resultat | append: "€ de plus et obtenez la livraison gratuite " %}
{% elsif cart.total_price >= montant1 and cart.total_price < montant2 %}
  {% assign resultat = montant2 | minus: cart.total_price | divided_by: 100.0 %}
  {% assign phrase = "Dépensez " | append: resultat | append: "€ de plus et obtenez une " | append: second_product.title %}
{% elsif cart.total_price >= montant2 and cart.total_price < montant3 %}
  {% assign resultat = montant3 | minus: cart.total_price | divided_by: 100.0 %}
  {% assign phrase = "Dépensez " | append: resultat | append: "€ de plus et obtenez une " | append: third_product.title %}
{% elsif cart.total_price >= montant3 %}
  {% assign phrase = "Vous avez obtenue une " | append: third_product.title | append: " gratuitement" %}
{% else %}
  {% assign resultat = montant1 | divided_by: 100.0 %}
  {% assign phrase = "A partir de " | append: resultat | append: "€ d'achat, on vous offre la livraison gratuitement " %}
{% endif %}

<style>
  .bg_king {
    background-image: url('{{ 'king.svg' | asset_url }}');
    width: 30px;
  }
</style>
{% if cart.total_price > 0 and cart.total_price < montant1 %}
  {% assign resultat = montant1 | minus: cart.total_price | divided_by: 100.0 %}
  {% assign phrase = "Dépensez " | append: resultat | append: "€ de plus et obtenez la livraison gratuite" %}
{% elsif cart.total_price >= montant1 and cart.total_price < montant2 %}
  {% assign resultat = montant2 | minus: cart.total_price | divided_by: 100.0 %}
  {% assign phrase = "Dépensez " | append: resultat | append: "€ de plus et obtenez une " | append: second_product.title %}
{% elsif cart.total_price >= montant2 and cart.total_price < montant3 %}
  {% assign resultat = montant3 | minus: cart.total_price | divided_by: 100.0 %}
  {% assign phrase = "Dépensez " | append: resultat | append: "€ de plus et obtenez une " | append: third_product.title %}
{% elsif cart.total_price >= montant3 %}
  {% assign phrase = "Vous avez obtenue une " | append: third_product.title | append: " gratuitement" %}
{% else %}
  {% assign resultat = montant1 | divided_by: 100.0 %}
  {% assign phrase = "A partir de " | append: resultat | append: "€ d'achat, on vous offre la livraison gratuitement" %}
{% endif %}

<style>
  .bg_king {
    background-image: url('{{ 'king.svg' | asset_url }}');
    width: 30px;
  }
</style>
<p class="h-[61px] w-[61px] me-3 me-8 text-[37px] ms-8 text-red-600 sm:w-auto w-[50%] hidden"></p>
<div
  class="panier fixed top-0 w-full hidden z-50 bg-white bg-opacity-50"
  id="panier"
  data-product1="{{ first_product.title }}"
  data-product2="{{ second_product.title }}"
  data-product3="{{ third_product.title }}"
  data-product1_id="{{ first_product.selected_or_first_available_variant.id }}"
  data-product2_id="{{ second_product.selected_or_first_available_variant.id }}"
  data-product3_id="{{ third_product.selected_or_first_available_variant.id }}"
  data-product1="{{ first_product.title }}"
  data-product2="{{ second_product.title }}"
  data-product3="{{ third_product.title }}"
  data-product1_img="{{ first_product | image_url }}"
  data-product2_img="{{ second_product | image_url }}"
  data-product3_img="{{ third_product | image_url }}">

  <div class="content sm:max-w-[455px] w-full ms-auto me-0 bg-[#FFFDF9] max-h-screen h-screen overflow-x-hidden overflow-y-scroll hide-scrolbar-y">
    <div class="flex justify-end w-full mx-auto px-4 pt-6 pb-4">
      <p id="close-panier" class="flex items-center font-medium text-_main_color_dark hover:cursor-pointer">
        <i class="fas fa-xmark text-[18px] me-2"></i>
        <span class="text-sm">Fermer</span>
      </p>
    </div>
    <!-- Zone d'affichage des messages d'incitation -->

    <div class="min-h-[88px] px-4 bg-_orange_color text-white p-2 pt-[35px] text-sm flex flex-col justify-center items-center" id="ZoneIncitation">
      `<div class="flex w-full mb-1 gap-1" id="progressBar">
        <div class="relative w-1/3 h-6 bg-white">
          <div class="bg-_main_color_light h-full text-xs font-medium text-blue-100 p-0.5 leading-none" style="width: 50%"></div>
          <span class="absolute top-0 right-0 mt-1 mr-1 text-_orange_color font-extrabold">` +
          </span>
          <span class="absolute top-0 right-0 -mt-8 mr-0 text-_main_color_light font-extrabold">
            <img
              class=""
              src="https://cdn.shopify.com/s/files/1/0747/8430/9521/files/king.svg?v=1691796016"
              alt="king"
              loading="lazy"
              width="auto"
              height="auto">
          </span>
        </div>

        <div class="relative w-1/3 h-6 bg-white">
          <div class="bg-white h-full text-xs font-medium text-blue-100 p-0.5 leading-none " style="width: 0%"></div>
          <span class="absolute top-0 right-0 mt-1 mr-1 text-_orange_color font-extrabold"></span>
        </div>

        <div class="relative w-1/3 h-6 bg-white">
          <div class="bg-white h-full text-xs font-medium text-blue-100 p-0.5 leading-none" style="width: 0%"></div>
          <span class="absolute top-0 right-0 mt-1 mr-1 text-_orange_color font-extrabold"></span>
        </div>
      </div>

    </div>

    <div class="items text-_main_color_dark">
      <h2 class="font-medium my-4 px-5" id="vous_avez_ajoute">Vous avez ajouté :</h2>
      <div id="panier-items-container">{% comment %} items content {% endcomment %}
      </div>
      <div id="zoneRecompense"></div>
      <div id="payment-div" class="mt-4">
        <hr class="border-[#999999] mt-8">
        <div class="total flex justify-between items-center px-5 mt-4">
          <div>
            <p class="font-medium">Sous-total</p>
            <p class="text-[#999999]">
              <span id="qty-items-panier">1</span>
              article dans votre parnier</p>
          </div>
          <p id="total-price-panier" class="font-medium">2,10 €</p>
        </div>
        <div class="flex flex-col items-center justify-center mt-8">
          <form
            action="{{ routes.cart_url }}"
            method="post"
            class="sm:w-[344px] w-[90%]">
            <button
              id="btn-paiement"
              type="submit"
              name="checkout"
              class="h-[44px] w-full btn-red-panier">Procéder au paiement</button>
          </form>
          <div class="sm:w-[344px] w-[90%]">
            <button id="btn-continuer" class="h-[44px] w-full btn-white-panier">Continuer mes achats</button>
          </div>
        </div>
      </div>

    </div>


    <div class="footer text-_main_color_dark px-2 my-8">
      <p class="font-medium text-_main_color_dark mt-3 ps-5">D’autres ont aussi achetés :</p>
      <div class="items flex gap-6 mt-5 justify-around">
        {%- for product in collections['suggestions-panier'].products -%}
          {% comment %} getting rating value {% endcomment %}
          {%- assign rates = product.metafields.reviews.rating.value | split: '.' -%}
          {%- assign n = rates | first | plus: 0 -%}

          <div class="item">
            <a href="{{ product.url }}" class="item text-[12px] max-w-[120px] w-full m-1 flex items-center flex-col gap-1">
              <div class="img w-full">
                <img
                  src="{{ product | image_url: width: 600, height: 600 }}"
                  alt="La gourmande aux noisettes"
                  class="w-full"
                  loading="lazy"
                  width="auto"
                  height="auto">
              </div>
              <p class="font-semibold text-center ">{{ product.title }}</p>
              {% if product.metafields.reviews.rating_count != null %}
                <div class="avis flex items-center gap-2 h-[1.1rem] mb-2">
                  <div class="stars flex text-black text-sm">

                    {%- for i in (1..5) -%}
                      {%- if i <= n -%}
                        <i class="fas fa-star"></i>
                      {%- else -%}
                        <i class="fa-regular fa-star"></i>
                      {%- endif -%}
                    {%- endfor -%}

                  </div>
                  <span class="border-_main_color_dark border-b-2 text-[10px] mb-2">
                    {% if product.metafields.reviews.rating_count == null %}
                      Soyez le 1er à noter!
                    {% else %}
                      {{ product.metafields.reviews.rating_count }} avis
                    {% endif %}
                  </span>
                </div>
              {%- endif -%}
              <p class="font-medium text-center">{{ product.price | money_without_currency }}€ le pack
              </p>
            </a>
          </div>
        {%- endfor -%}

      </div>
    </div>


  </div>
</div>